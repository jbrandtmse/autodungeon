/* Campfire theme for autodungeon Streamlit UI */
/* Story 2.1: Streamlit Application Shell */

/* Google Fonts import for Lora, Inter, and JetBrains Mono */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Lora:ital,wght@0,400;0,600;1,400&display=swap');

/* ==========================================================================
   CSS Variables (from UX Design Specification)
   ========================================================================== */

:root {
  /* Background Colors */
  --bg-primary: #1A1612;    /* Deep warm black - main canvas */
  --bg-secondary: #2D2520;  /* Warm gray-brown - elevated surfaces */
  --bg-message: #3D3530;    /* Message bubble background */

  /* Text Colors */
  --text-primary: #F5E6D3;  /* Warm off-white */
  --text-secondary: #B8A896; /* Muted warm gray */

  /* Accent */
  --accent-warm: #E8A849;   /* Amber highlight */

  /* Character Identity Colors */
  --color-dm: #D4A574;      /* DM/Narrator - warm gold */
  --color-fighter: #C45C4A; /* Fighter - bold red */
  --color-rogue: #6B8E6B;   /* Rogue - forest green */
  --color-wizard: #7B68B8;  /* Wizard - mystic purple */
  --color-cleric: #4A90A4;  /* Cleric - calm blue */

  /* Font Stack */
  --font-narrative: 'Lora', Georgia, serif;
  --font-ui: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  /* Font Sizes */
  --text-dm: 18px;          /* DM narration */
  --text-pc: 17px;          /* PC dialogue */
  --text-name: 14px;        /* Character names, 600 weight */
  --text-ui: 14px;          /* UI controls */
  --text-system: 13px;      /* System text */

  /* Spacing (8px base grid) */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;

  /* Layout */
  --sidebar-width: 240px;
  --max-content-width: 100%;  /* Fill available width */
}

/* ==========================================================================
   Base Layout - Hide Streamlit defaults
   ========================================================================== */

/* Hide Streamlit branding and defaults, but keep sidebar toggle */
#MainMenu { visibility: hidden; }
footer { visibility: hidden; }

/* Hide header content but keep the sidebar collapse button functional */
[data-testid="stHeader"] {
  background-color: transparent;
}

/* Style the sidebar collapse button to match theme */
[data-testid="stSidebarCollapsedControl"] button {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
}

[data-testid="stSidebarCollapsedControl"] button:hover {
  background-color: var(--bg-message);
}

/* Apply dark theme background to entire app */
.stApp {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  font-family: var(--font-ui);
}

/* ==========================================================================
   Sidebar Styling - 240px fixed width
   ========================================================================== */

/* Streamlit sidebar container */
[data-testid="stSidebar"] {
  background-color: var(--bg-secondary);
  width: var(--sidebar-width) !important;
  min-width: var(--sidebar-width) !important;
  max-width: var(--sidebar-width) !important;
}

[data-testid="stSidebar"] > div:first-child {
  width: var(--sidebar-width) !important;
  padding: var(--space-md);
  box-sizing: border-box;
}

/* Sidebar text styling */
[data-testid="stSidebar"] h1,
[data-testid="stSidebar"] h2,
[data-testid="stSidebar"] h3 {
  color: var(--text-primary);
  font-family: var(--font-ui);
}

[data-testid="stSidebar"] p,
[data-testid="stSidebar"] span,
[data-testid="stSidebar"] label {
  color: var(--text-secondary);
  font-size: var(--text-ui);
}

/* Sidebar scrollability */
[data-testid="stSidebar"] > div:first-child {
  overflow-y: auto;
  max-height: 100vh;
}

/* Sidebar divider spacing - balanced */
[data-testid="stSidebar"] hr {
  margin: var(--space-sm) 0;
}

/* Sidebar section headings */
[data-testid="stSidebar"] h3 {
  margin: var(--space-xs) 0 var(--space-xs) 0 !important;
  font-size: 14px;
}

/* Custom scrollbar styling - dark theme */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--text-secondary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-warm);
}

/* Firefox scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--text-secondary) var(--bg-secondary);
}

/* ==========================================================================
   Main Content Area
   ========================================================================== */

/* Main content container - fill available width */
.main .block-container,
.stMainBlockContainer,
[data-testid="stMainBlockContainer"] {
  max-width: 100%;
  margin: 0;
  padding: var(--space-sm) var(--space-lg) var(--space-md) var(--space-lg) !important;
  padding-top: var(--space-sm) !important;
}

/* Remove Streamlit's default top padding */
.main > div:first-child {
  padding-top: 0 !important;
}

/* Target Streamlit's internal padding */
[data-testid="stAppViewContainer"] > section > div {
  padding-top: 0 !important;
}

/* Remove gaps between Streamlit vertical blocks in main area only */
.main [data-testid="stVerticalBlock"] {
  gap: 0 !important;
}

/* Keep proper gaps in sidebar for readability - prevent overlap */
[data-testid="stSidebar"] [data-testid="stVerticalBlock"] {
  gap: var(--space-sm) !important;
}

/* Remove default margins on Streamlit markdown elements in main area */
.main [data-testid="stMarkdown"] {
  margin: 0 !important;
  padding: 0 !important;
}

/* Target Streamlit element containers in main area */
.main .element-container {
  margin: 0 !important;
}

/* Reset stHeadingContainer margins */
[data-testid="stHeadingContainer"] {
  padding: 0 !important;
}

/* Make session-header directly connect to narrative-container */
.session-header + div {
  margin-top: 0 !important;
}

/* Headings */
h1 {
  color: var(--accent-warm);
  font-family: var(--font-narrative);
  font-weight: 600;
  margin: 0 !important;
  padding: 0 !important;
}

h2, h3, h4 {
  color: var(--text-primary);
  font-family: var(--font-ui);
}

/* Target the session-header h1 specifically */
.session-header h1,
.session-title {
  margin: 0 !important;
  padding: 0 !important;
}

/* Narrative text styling */
.narrative-text {
  font-family: var(--font-narrative);
  font-size: var(--text-dm);
  color: var(--text-primary);
  line-height: 1.6;
}

/* ==========================================================================
   Message Components (Story 2.2)
   ========================================================================== */

/* DM Message Block - narrator styling with gold border */
.dm-message {
  background: var(--bg-message);
  border-left: 4px solid var(--color-dm);
  padding: var(--space-md) var(--space-lg);
  margin-bottom: var(--space-md);
  border-radius: 0 8px 8px 0;
}

.dm-message p {
  font-family: var(--font-narrative);
  font-size: var(--text-dm);
  line-height: 1.6;
  color: var(--text-primary);
  font-style: italic;
  text-align: justify;
  margin: 0;
}

/* PC Message Block - character-colored borders */
.pc-message {
  background: var(--bg-message);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
  border-radius: 8px;
  border-left: 3px solid var(--text-secondary);
}

.pc-message p {
  font-family: var(--font-narrative);
  font-size: var(--text-pc);
  line-height: 1.6;
  color: var(--text-primary);
  text-align: justify;
  margin: 0;
}

/* PC Attribution - "Name, the Class:" format */
.pc-attribution {
  font-family: var(--font-narrative);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: var(--space-xs);
}

/* Action text styling - italicized for actions/narration vs dialogue */
.action-text {
  font-style: italic;
  color: var(--text-secondary);
}

/* Character-specific PC message classes */
.pc-message.fighter { border-left-color: var(--color-fighter); }
.pc-message.rogue { border-left-color: var(--color-rogue); }
.pc-message.wizard { border-left-color: var(--color-wizard); }
.pc-message.cleric { border-left-color: var(--color-cleric); }

/* Character-specific PC attribution classes */
.pc-attribution.fighter { color: var(--color-fighter); }
.pc-attribution.rogue { color: var(--color-rogue); }
.pc-attribution.wizard { color: var(--color-wizard); }
.pc-attribution.cleric { color: var(--color-cleric); }

/* Sheet Change Notification (Story 8.5) */
.sheet-notification {
  background: rgba(232, 168, 73, 0.08);
  border-left: 3px solid var(--accent-warm);
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-sm);
  border-radius: 0 6px 6px 0;
}

.sheet-notification p {
  font-family: var(--font-ui);
  font-size: 14px;
  line-height: 1.4;
  color: var(--accent-warm);
  margin: 0;
}

/* ==========================================================================
   Session Header (Story 2.2)
   ========================================================================== */

/* Session header - chronicle style (compact) */
.session-header {
  text-align: center;
  padding: var(--space-xs) 0;
  border-bottom: 1px solid var(--bg-secondary);
  margin-bottom: 0;
}

/* Pull narrative container up to eliminate Streamlit wrapper gaps */
.narrative-container {
  margin-top: 0 !important;
}

.session-title {
  font-family: var(--font-narrative);
  font-size: 20px;
  font-weight: 600;
  color: var(--color-dm);
  letter-spacing: 0.05em;
  margin: 0;
}

.session-subtitle {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  margin-top: 2px;
}

/* ==========================================================================
   Character Cards (Story 2.2)
   ========================================================================== */

/* Party panel in sidebar */
.party-panel {
  background-color: var(--bg-message);
  border-radius: 8px;
  padding: var(--space-md);
  margin-top: var(--space-md);
}

/* Character card with character-color left border */
.character-card {
  background: var(--bg-secondary);
  border-radius: 6px;
  padding: var(--space-sm);
  margin-bottom: var(--space-sm);
  border-left: 3px solid var(--text-secondary);
}

/* Controlled state - glow effect, filled background */
.character-card.controlled {
  background: var(--bg-message);
  border-left-width: 4px;
  box-shadow: 0 0 12px rgba(232, 168, 73, 0.2);
}

/* Character-specific controlled glow colors (Story 3.3) */
.character-card.controlled.fighter {
  box-shadow: 0 0 12px 2px rgba(196, 92, 74, 0.3);
}

.character-card.controlled.rogue {
  box-shadow: 0 0 12px 2px rgba(107, 142, 107, 0.3);
}

.character-card.controlled.wizard {
  box-shadow: 0 0 12px 2px rgba(123, 104, 184, 0.3);
}

.character-card.controlled.cleric {
  box-shadow: 0 0 12px 2px rgba(74, 144, 164, 0.3);
}

/* Smooth transition for control state changes (Story 3.3) */
.character-card {
  transition: box-shadow 0.2s ease-in-out, border-left-width 0.2s ease-in-out, background 0.2s ease-in-out;
}

/* Character name styling */
.character-name {
  font-family: var(--font-ui);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--text-primary);
}

/* Character class label in party panel */
.character-class {
  font-size: var(--text-system);
  color: var(--text-secondary);
}

/* Character-specific card classes */
.character-card.fighter { border-left-color: var(--color-fighter); }
.character-card.rogue { border-left-color: var(--color-rogue); }
.character-card.wizard { border-left-color: var(--color-wizard); }
.character-card.cleric { border-left-color: var(--color-cleric); }

/* Character-specific name classes */
.character-name.fighter { color: var(--color-fighter); }
.character-name.rogue { color: var(--color-rogue); }
.character-name.wizard { color: var(--color-wizard); }
.character-name.cleric { color: var(--color-cleric); }

/* ==========================================================================
   Drop-In Button (Story 2.2)
   ========================================================================== */

/* Drop-In button - outline style with character theming */
.drop-in-button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  border-radius: 4px;
  padding: 6px 12px;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  cursor: pointer;
  transition: all 0.15s ease;
  width: 100%;
  margin-top: var(--space-xs);
}

.drop-in-button:hover {
  background: var(--text-secondary);
  color: var(--bg-primary);
}

.drop-in-button.active {
  background: var(--accent-warm);
  border-color: var(--accent-warm);
  color: var(--bg-primary);
}

/* Character-specific Drop-In button classes */
.drop-in-button.fighter { border-color: var(--color-fighter); color: var(--color-fighter); }
.drop-in-button.fighter:hover { background: var(--color-fighter); color: var(--bg-primary); }
.drop-in-button.rogue { border-color: var(--color-rogue); color: var(--color-rogue); }
.drop-in-button.rogue:hover { background: var(--color-rogue); color: var(--bg-primary); }
.drop-in-button.wizard { border-color: var(--color-wizard); color: var(--color-wizard); }
.drop-in-button.wizard:hover { background: var(--color-wizard); color: var(--bg-primary); }
.drop-in-button.cleric { border-color: var(--color-cleric); color: var(--color-cleric); }
.drop-in-button.cleric:hover { background: var(--color-cleric); color: var(--bg-primary); }

/* ==========================================================================
   Character Card Wrapper & Streamlit Button Overrides (Story 2.4)
   ========================================================================== */

/* Wrapper div that contains both the card and the Streamlit button */
.character-card-wrapper {
  margin-bottom: var(--space-sm);
}

/* Reset default Streamlit button styling inside character card wrappers */
.character-card-wrapper .stButton > button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  border-radius: 4px;
  padding: 6px 12px;
  font-size: var(--text-system);
  width: 100%;
  margin-top: var(--space-xs);
  transition: all 0.15s ease;
}

/* Fighter Drop-In button */
.character-card-wrapper.fighter .stButton > button {
  border-color: var(--color-fighter);
  color: var(--color-fighter);
}
.character-card-wrapper.fighter .stButton > button:hover {
  background: var(--color-fighter);
  color: var(--bg-primary);
}

/* Rogue Drop-In button */
.character-card-wrapper.rogue .stButton > button {
  border-color: var(--color-rogue);
  color: var(--color-rogue);
}
.character-card-wrapper.rogue .stButton > button:hover {
  background: var(--color-rogue);
  color: var(--bg-primary);
}

/* Wizard Drop-In button */
.character-card-wrapper.wizard .stButton > button {
  border-color: var(--color-wizard);
  color: var(--color-wizard);
}
.character-card-wrapper.wizard .stButton > button:hover {
  background: var(--color-wizard);
  color: var(--bg-primary);
}

/* Cleric Drop-In button */
.character-card-wrapper.cleric .stButton > button {
  border-color: var(--color-cleric);
  color: var(--color-cleric);
}
.character-card-wrapper.cleric .stButton > button:hover {
  background: var(--color-cleric);
  color: var(--bg-primary);
}

/* Controlled state - Release button uses amber accent */
.character-card-wrapper.controlled .stButton > button {
  background: var(--accent-warm);
  border-color: var(--accent-warm);
  color: var(--bg-primary);
}
.character-card-wrapper.controlled .stButton > button:hover {
  background: #D49A3D;
}

/* ==========================================================================
   Mode Indicator (Story 2.2)
   ========================================================================== */

/* Mode indicator - Watch/Play mode badges */
.mode-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: 4px 12px;
  border-radius: 16px;
  font-family: var(--font-ui);
  font-size: 12px;
  font-weight: 500;
  transition: background 0.2s ease-in-out, color 0.2s ease-in-out;  /* Story 3.5 */
}

.mode-indicator.watch {
  background: rgba(107, 142, 107, 0.2);
  color: #6B8E6B;
}

.mode-indicator.play {
  background: rgba(232, 168, 73, 0.2);
  color: var(--accent-warm);
}

/* Pulsing dot animation for mode indicator */
.pulse-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
  animation: pulse 2s ease-in-out infinite;
  display: inline-block;
  flex-shrink: 0;
}

/* Explicit pulse dot colors for mode indicator (Story 3.1) */
.mode-indicator.watch .pulse-dot {
  background: #6B8E6B;
}

.mode-indicator.play .pulse-dot {
  background: var(--accent-warm);
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.8); }
}

/* Mode indicator character colors for play mode (Story 2.5) */
.mode-indicator.play.fighter {
  background: rgba(196, 92, 74, 0.2);
  color: var(--color-fighter);
}
.mode-indicator.play.rogue {
  background: rgba(107, 142, 107, 0.2);
  color: var(--color-rogue);
}
.mode-indicator.play.wizard {
  background: rgba(123, 104, 184, 0.2);
  color: var(--color-wizard);
}
.mode-indicator.play.cleric {
  background: rgba(74, 144, 164, 0.2);
  color: var(--color-cleric);
}

/* Paused mode indicator (Story 3.5) */
.mode-indicator.paused {
  background: rgba(232, 168, 73, 0.2);
  color: var(--accent-warm);
}

/* Static pause dot - no animation (Story 3.5 AC #1) */
.pause-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--accent-warm);
  display: inline-block;
  flex-shrink: 0;
  /* No animation - static to differentiate from active states */
}


/* ==========================================================================
   Session Controls (Story 2.5)
   ========================================================================== */

.session-controls {
  margin-top: var(--space-md);
  padding: var(--space-sm);
}

.session-controls .control-row {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.session-controls .control-label {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  min-width: 60px;
}

/* Secondary button style for session controls (per button hierarchy) */
.control-button-secondary {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
  border-radius: 4px;
  padding: 6px 12px;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  cursor: pointer;
  transition: all 0.15s ease;
}

.control-button-secondary:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
}

/* Speed dropdown styling to match theme */
.speed-select {
  background: var(--bg-secondary);
  border: 1px solid var(--bg-message);
  color: var(--text-primary);
  border-radius: 4px;
  padding: 6px 12px;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  cursor: pointer;
}

/* Sidebar session controls - secondary button styling for Pause/Resume only
   Uses :not() to exclude character card buttons which have their own styling */
[data-testid="stSidebar"] .stButton > button:not([data-testid*="drop_in"]) {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

/* Ensure session controls button doesn't override character card buttons */
.session-controls .stButton > button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

/* ==========================================================================
   Input Context Bar (Story 2.2)
   ========================================================================== */

.input-context {
  background: var(--bg-secondary);
  border-left: 3px solid var(--accent-warm);
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-sm);
  border-radius: 0 4px 4px 0;
}

.input-context-text {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
}

.input-context-character {
  color: var(--accent-warm);
  font-weight: 500;
}

/* Character-specific input context bar colors (Story 3.2) */
.input-context.fighter {
  border-left-color: var(--color-fighter);
}
.input-context.fighter .input-context-character {
  color: var(--color-fighter);
}

.input-context.rogue {
  border-left-color: var(--color-rogue);
}
.input-context.rogue .input-context-character {
  color: var(--color-rogue);
}

.input-context.wizard {
  border-left-color: var(--color-wizard);
}
.input-context.wizard .input-context-character {
  color: var(--color-wizard);
}

.input-context.cleric {
  border-left-color: var(--color-cleric);
}
.input-context.cleric .input-context-character {
  color: var(--color-cleric);
}

/* ==========================================================================
   Narrative Container (Story 2.2, 2.6)
   ========================================================================== */

/* Note: .narrative-container is defined in Real-time Narrative Flow section */

/* Narrative placeholder text (before game starts) */
.narrative-placeholder {
  font-family: var(--font-narrative);
  font-size: var(--text-dm);
  color: var(--text-secondary);
  font-style: italic;
}

/* ==========================================================================
   Streamlit Widget Overrides (Story 2.2)
   ========================================================================== */

/* Text inputs and text areas */
.stTextInput > div > div > input,
.stTextArea > div > div > textarea {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--bg-message);
  border-radius: 4px;
  font-family: var(--font-ui);
}

.stTextInput > div > div > input:focus,
.stTextArea > div > div > textarea:focus {
  border-color: var(--accent-warm);
  box-shadow: 0 0 0 1px var(--accent-warm);
}

/* Buttons - following hierarchy (primary amber, secondary outline) */
.stButton > button {
  background-color: var(--accent-warm);
  color: var(--bg-primary);
  border: none;
  border-radius: 4px;
  font-family: var(--font-ui);
  font-weight: 500;
  transition: all 0.15s ease;
}

.stButton > button:hover {
  background-color: #D49A3D;
}

/* Secondary button variant */
.stButton > button[kind="secondary"] {
  background-color: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

/* Selectbox styling */
.stSelectbox > div > div {
  background-color: var(--bg-secondary);
  border-color: var(--bg-message);
}

.stSelectbox [data-baseweb="select"] {
  background-color: var(--bg-secondary);
}

/* Expander styling */
.streamlit-expanderHeader {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  border-radius: 4px;
}

/* Spinner styling */
.stSpinner > div {
  border-top-color: var(--accent-warm);
}

/* Info boxes */
.stAlert {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  border-radius: 4px;
}

/* Dividers */
hr {
  border-color: var(--bg-message);
}

/* ==========================================================================
   Viewport Warning - Shows for screens < 1024px
   ========================================================================== */

.viewport-warning {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-primary);
  z-index: 9999;
  color: var(--text-primary);
  font-family: var(--font-ui);
  padding: 2rem;
  text-align: center;
}

.viewport-warning h2 {
  color: var(--accent-warm);
  margin-bottom: var(--space-md);
}

.app-content {
  display: block;
}

@media (max-width: 1023px) {
  .viewport-warning {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .app-content {
    display: none;
  }
}

/* ==========================================================================
   Real-time Narrative Flow (Story 2.6)
   ========================================================================== */

/* Thinking indicator with 500ms delay (NFR3) */
.thinking-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-md);
  color: var(--text-secondary);
  font-family: var(--font-narrative);
  font-style: italic;
  opacity: 0;
  animation: fade-in-delayed 0.3s ease-in 0.5s forwards;
}

@keyframes fade-in-delayed {
  to { opacity: 1; }
}

.thinking-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--accent-warm);
  animation: pulse 1.5s ease-in-out infinite;
}

.thinking-text {
  font-size: var(--text-pc);
}

/* Summarization indicator (Story 5.2) */
.summarization-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  color: var(--text-secondary);
  font-family: var(--font-ui);
  font-size: var(--text-system);
  font-style: italic;
  opacity: 0.7;
}

.summarization-text {
  font-size: var(--text-system);
}

/* Current turn highlight - subtle glow that fades (AC#3) */
.dm-message.current-turn,
.pc-message.current-turn {
  animation: current-turn-highlight 3s ease-out;
}

@keyframes current-turn-highlight {
  0% {
    box-shadow: 0 0 15px rgba(232, 168, 73, 0.4);
  }
  100% {
    box-shadow: none;
  }
}

/* Game controls (Start Game / Next Turn button) - now in sidebar */
.game-controls {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin: var(--space-sm) 0;
}

/* Primary button styling for game controls */
.game-controls .stButton > button {
  background-color: var(--accent-warm);
  color: var(--bg-primary);
  border: none;
  border-radius: 4px;
  font-family: var(--font-ui);
  font-weight: 500;
  padding: var(--space-xs) var(--space-md);
  width: 100%;
}

.game-controls .stButton > button:hover:not(:disabled) {
  background-color: #D49A3D;
}

.game-controls .stButton > button:disabled {
  background-color: var(--bg-message);
  color: var(--text-secondary);
  cursor: not-allowed;
}

/* Auto-scroll indicator (AC#2) */
.auto-scroll-indicator {
  position: sticky;
  bottom: var(--space-md);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(45, 37, 32, 0.9);
  border: 1px solid var(--bg-message);
  border-radius: 20px;
  padding: var(--space-xs) var(--space-md);
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 100;
  text-align: center;
  width: fit-content;
  margin: 0 auto;
}

.auto-scroll-indicator.visible {
  opacity: 1;
}

.auto-scroll-indicator:hover {
  background: var(--bg-message);
  color: var(--text-primary);
}

/* Narrative container scrollable (AC#4) */
.narrative-container {
  background-color: var(--bg-primary);
  min-height: 400px;
  max-height: 80vh;
  overflow-y: auto;
  scroll-behavior: smooth;
  padding: var(--space-xs) var(--space-md);
  position: relative;
}

/* ==========================================================================
   Human Input Area (Story 3.2)
   ========================================================================== */

/* Container for human action input */
.human-input-area {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  margin-top: var(--space-md);
}

/* Text area styling for human input */
.human-input-area .stTextArea > div > div > textarea {
  background: var(--bg-message) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--bg-message) !important;
  border-radius: 4px;
  font-family: var(--font-narrative);
  font-size: 16px;
  line-height: 1.6;
  min-height: 80px;
}

.human-input-area .stTextArea > div > div > textarea:focus {
  border-color: var(--accent-warm) !important;
  box-shadow: 0 0 0 1px var(--accent-warm);
}

/* Submit button styling */
.human-input-area .stButton > button {
  background: var(--accent-warm) !important;
  color: var(--bg-primary) !important;
  border: none !important;
  font-weight: 500;
}

.human-input-area .stButton > button:hover:not(:disabled) {
  background: #D49A3D !important;
}

.human-input-area .stButton > button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ==========================================================================
   Nudge Input Widget (Story 3.4)
   ========================================================================== */

.nudge-input-container {
  margin-top: var(--space-md);
  padding-top: var(--space-md);
}

.nudge-label {
  display: block;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: var(--space-xs);
}

.nudge-hint {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  margin: var(--space-xs) 0 var(--space-sm) 0;
  font-style: italic;
}

/* Nudge text area styling */
[data-testid="stSidebar"] .nudge-input-container + div textarea {
  background: var(--bg-message) !important;
  border: 1px solid var(--bg-message) !important;
}

[data-testid="stSidebar"] .nudge-input-container + div textarea:focus {
  border-color: var(--color-rogue) !important;  /* Green for suggestions */
}

/* Nudge submit button - uses green accent to differentiate from Drop-In */
[data-testid="stSidebar"] .nudge-input-container ~ div .stButton > button {
  background: transparent;
  border: 1px solid var(--color-rogue);
  color: var(--color-rogue);
}

[data-testid="stSidebar"] .nudge-input-container ~ div .stButton > button:hover {
  background: var(--color-rogue);
  color: var(--bg-primary);
}

/* ==========================================================================
   Human Whisper to DM Input Widget (Story 10.4)
   ========================================================================== */

.whisper-input-container {
  margin-top: var(--space-md);
  padding-top: var(--space-md);
}

.whisper-label {
  display: block;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: var(--space-xs);
}

.whisper-hint {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  margin: var(--space-xs) 0 var(--space-sm) 0;
  font-style: italic;
}

/* Whisper text area styling */
[data-testid="stSidebar"] .whisper-input-container + div textarea {
  background: var(--bg-message) !important;
  border: 1px solid var(--bg-message) !important;
}

[data-testid="stSidebar"] .whisper-input-container + div textarea:focus {
  border-color: var(--color-wizard) !important;  /* Purple for private whispers */
}

/* Whisper submit button - uses purple accent to differentiate from nudge (green) */
[data-testid="stSidebar"] .whisper-input-container ~ div .stButton > button {
  background: transparent;
  border: 1px solid var(--color-wizard);
  color: var(--color-wizard);
}

[data-testid="stSidebar"] .whisper-input-container ~ div .stButton > button:hover {
  background: var(--color-wizard);
  color: var(--bg-primary);
}

/* ==========================================================================
   Keyboard Shortcuts Help (Story 3.6)
   ========================================================================== */

.keyboard-shortcuts-help {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: var(--space-sm);
  margin-bottom: var(--space-sm);
  text-align: center;
}

.keyboard-shortcuts-help .help-text {
  color: var(--text-secondary);
}

.keyboard-shortcuts-help kbd {
  display: inline-block;
  padding: 2px 6px;
  margin: 0 2px;
  font-family: var(--font-mono);
  font-size: 10px;
  background: var(--bg-message);
  border: 1px solid var(--bg-secondary);
  border-radius: 3px;
  color: var(--text-primary);
}

/* ==========================================================================
   Checkpoint Browser (Story 4.2)
   ========================================================================== */

/* Container for checkpoint list */
.checkpoint-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

/* Individual checkpoint entry */
.checkpoint-entry {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  border-left: 3px solid var(--accent-warm);
  transition: background 0.15s ease;
}

.checkpoint-entry:hover {
  background: var(--bg-message);
}

/* Header row with turn number and timestamp */
.checkpoint-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-xs);
}

/* Turn number styling */
.checkpoint-turn {
  font-family: var(--font-ui);
  font-weight: 600;
  font-size: var(--text-name);
  color: var(--text-primary);
}

/* Timestamp styling (secondary text) */
.checkpoint-timestamp {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
}

/* Context preview text (italic, truncated) */
.checkpoint-context {
  font-family: var(--font-narrative);
  font-size: var(--text-system);
  font-style: italic;
  color: var(--text-secondary);
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4;
}

/* Preview expanded section */
.checkpoint-preview {
  background: var(--bg-primary);
  border-radius: 4px;
  padding: var(--space-sm);
  margin: var(--space-sm) 0;
  border-left: 2px solid var(--text-secondary);
}

.checkpoint-preview p {
  font-family: var(--font-narrative);
  font-size: var(--text-system);
  color: var(--text-secondary);
  margin: var(--space-xs) 0;
  line-height: 1.4;
}

/* Restore confirmation warning styling */
.restore-confirmation {
  background: rgba(232, 168, 73, 0.1);
  border: 1px solid var(--accent-warm);
  border-radius: 8px;
  padding: var(--space-md);
  margin: var(--space-md) 0;
}

.restore-confirmation .warning-text {
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  color: var(--accent-warm);
  margin-bottom: var(--space-sm);
}

/* Checkpoint browser buttons in sidebar */
[data-testid="stSidebar"] .checkpoint-list .stButton > button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  font-size: 12px;
  padding: 4px 8px;
  margin: 2px 0;
}

[data-testid="stSidebar"] .checkpoint-list .stButton > button:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
  color: var(--text-primary);
}

/* Restore button - amber accent */
[data-testid="stSidebar"] .stButton > button[data-testid*="restore_"] {
  border-color: var(--accent-warm);
  color: var(--accent-warm);
}

[data-testid="stSidebar"] .stButton > button[data-testid*="restore_"]:hover {
  background: var(--accent-warm);
  color: var(--bg-primary);
}

/* Confirm restore button */
[data-testid="stSidebar"] .stButton > button[data-testid="confirm_restore"] {
  background: var(--accent-warm);
  border-color: var(--accent-warm);
  color: var(--bg-primary);
}

[data-testid="stSidebar"] .stButton > button[data-testid="confirm_restore"]:hover {
  background: #D49A3D;
}

/* Preview button styling */
[data-testid="stSidebar"] .stButton > button[data-testid*="preview_"] {
  border-color: var(--text-secondary);
  color: var(--text-secondary);
}

[data-testid="stSidebar"] .stButton > button[data-testid*="preview_"]:hover {
  background: var(--bg-message);
  color: var(--text-primary);
}

/* Empty checkpoint message */
.checkpoint-empty {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  font-style: italic;
  text-align: center;
  padding: var(--space-md);
}

/* ==========================================================================
   Session Browser (Story 4.3)
   ========================================================================== */

/* Container for session browser view */
.session-browser {
  max-width: 600px;
  margin: 0 auto;
  padding: var(--space-lg);
}

.session-browser-header {
  font-family: var(--font-narrative);
  font-size: 24px;
  font-weight: 600;
  color: var(--color-dm);
  margin-bottom: var(--space-lg);
  text-align: center;
}

.session-browser-empty {
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  color: var(--text-secondary);
  font-style: italic;
  text-align: center;
  padding: var(--space-xl);
}

/* Individual session card */
.session-card {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  margin-bottom: var(--space-sm);
  border-left: 4px solid var(--color-dm);
  transition: background 0.15s ease, box-shadow 0.15s ease;
}

.session-card:hover {
  background: var(--bg-message);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

/* Session card header with session number */
.session-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-xs);
}

.session-card-title {
  font-family: var(--font-narrative);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--color-dm);
  letter-spacing: 0.05em;
}

/* Session name */
.session-card-name {
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: var(--space-sm);
}

/* Meta info row (date, turns) */
.session-card-meta {
  display: flex;
  gap: var(--space-md);
  margin-bottom: var(--space-xs);
}

.session-card-date,
.session-card-turns {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
}

/* Character names list */
.session-card-characters {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  font-style: italic;
}

/* New session button container */
.new-session-container {
  margin-top: var(--space-lg);
  text-align: center;
}

/* New session button styling */
.session-browser .stButton > button {
  background: var(--accent-warm);
  color: var(--bg-primary);
  border: none;
  border-radius: 4px;
  font-family: var(--font-ui);
  font-weight: 500;
}

.session-browser .stButton > button:hover {
  background: #D49A3D;
}

/* Continue button styling */
.session-browser .stButton > button[data-testid*="continue_"] {
  background: transparent;
  border: 1px solid var(--color-dm);
  color: var(--color-dm);
}

.session-browser .stButton > button[data-testid*="continue_"]:hover {
  background: var(--color-dm);
  color: var(--bg-primary);
}

.session-browser .stButton > button[data-testid*="continue_"]:disabled {
  background: transparent;
  border-color: var(--text-secondary);
  color: var(--text-secondary);
  opacity: 0.5;
  cursor: not-allowed;
}

/* ==========================================================================
   Recap Modal (Story 4.3)
   ========================================================================== */

/* "While you were away" recap modal */
.recap-modal {
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: var(--space-xl);
  max-width: 600px;
  margin: var(--space-xl) auto;
  border: 1px solid var(--bg-message);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.recap-header {
  font-family: var(--font-narrative);
  font-size: 22px;
  font-weight: 600;
  color: var(--color-dm);
  margin-bottom: var(--space-lg);
  text-align: center;
}

.recap-content {
  margin-bottom: var(--space-lg);
}

.recap-item {
  font-family: var(--font-narrative);
  font-size: var(--text-pc);
  color: var(--text-primary);
  line-height: 1.6;
  margin: var(--space-sm) 0;
  padding-left: var(--space-md);
  border-left: 2px solid var(--accent-warm);
}

/* Recap continue button */
.recap-modal .stButton > button {
  background: var(--accent-warm);
  color: var(--bg-primary);
  border: none;
  border-radius: 4px;
  font-family: var(--font-ui);
  font-weight: 500;
  width: 100%;
}

.recap-modal .stButton > button:hover {
  background: #D49A3D;
}

/* Back to Sessions button in sidebar */
[data-testid="stSidebar"] .stButton > button[data-testid="back_to_sessions_btn"] {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  width: 100%;
}

[data-testid="stSidebar"] .stButton > button[data-testid="back_to_sessions_btn"]:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
  color: var(--text-primary);
}

/* ==========================================================================
   Export Transcript Button (Story 4.4)
   ========================================================================== */

/* Export Transcript button - secondary button styling */
[data-testid="stSidebar"] .stDownloadButton > button,
[data-testid="stSidebar"] .stButton > button[data-testid="export_transcript_btn"] {
  background: transparent;
  border: 1px solid var(--color-rogue);  /* Green accent for export/research */
  color: var(--color-rogue);
  width: 100%;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  transition: all 0.15s ease;
}

[data-testid="stSidebar"] .stDownloadButton > button:hover,
[data-testid="stSidebar"] .stButton > button[data-testid="export_transcript_btn"]:hover {
  background: var(--color-rogue);
  color: var(--bg-primary);
}

/* Disabled state for export button */
[data-testid="stSidebar"] .stDownloadButton > button:disabled,
[data-testid="stSidebar"] .stButton > button[data-testid="export_transcript_btn"]:disabled {
  background: transparent;
  border-color: var(--text-secondary);
  color: var(--text-secondary);
  opacity: 0.5;
  cursor: not-allowed;
}

/* ==========================================================================
   Error Panel (Story 4.5)
   ========================================================================== */

/* Error panel container - campfire aesthetic with warm tones */
.error-panel {
  background: linear-gradient(180deg, rgba(196, 92, 74, 0.15) 0%, var(--bg-secondary) 100%);
  border: 1px solid rgba(196, 92, 74, 0.4);
  border-left: 4px solid var(--color-fighter);  /* Red accent for errors */
  border-radius: 8px;
  padding: var(--space-lg);
  margin-bottom: var(--space-lg);
  animation: error-fade-in 0.3s ease-out;
}

@keyframes error-fade-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Error panel title - narrative font, amber color */
.error-panel-title {
  font-family: var(--font-narrative);
  font-size: 20px;
  font-weight: 600;
  color: var(--accent-warm);
  margin: 0 0 var(--space-md) 0;
  letter-spacing: 0.02em;
}

/* Error panel message - warm white, readable */
.error-panel-message {
  font-family: var(--font-narrative);
  font-size: var(--text-pc);
  color: var(--text-primary);
  line-height: 1.6;
  margin: 0 0 var(--space-sm) 0;
}

/* Error panel action suggestion - secondary text */
.error-panel-action {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  font-style: italic;
  margin: 0 0 var(--space-md) 0;
}

/* Error panel button container */
.error-panel-actions {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

/* Error panel buttons - base styling */
.error-panel-actions button {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  padding: var(--space-sm) var(--space-md);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

/* Retry button - primary amber */
.error-retry-btn {
  background: var(--accent-warm);
  border: none;
  color: var(--bg-primary);
}

.error-retry-btn:hover:not(:disabled) {
  background: #D49A3D;
}

.error-retry-btn:disabled,
.error-retry-btn.disabled {
  background: var(--bg-message);
  color: var(--text-secondary);
  cursor: not-allowed;
}

/* Restore button - secondary outline */
.error-restore-btn {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

.error-restore-btn:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
}

/* New session button - subtle outline */
.error-new-session-btn {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
}

.error-new-session-btn:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
  color: var(--text-primary);
}

/* Streamlit button overrides for error panel */
.error-panel + div .stButton > button[key="error_retry_btn"] {
  background: var(--accent-warm);
  border: none;
  color: var(--bg-primary);
}

.error-panel + div .stButton > button[key="error_retry_btn"]:hover:not(:disabled) {
  background: #D49A3D;
}

.error-panel + div .stButton > button[key="error_retry_btn"]:disabled {
  background: var(--bg-message);
  color: var(--text-secondary);
}

.error-panel + div .stButton > button[key="error_restore_btn"],
.error-panel + div .stButton > button[key="error_new_session_btn"] {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

.error-panel + div .stButton > button[key="error_restore_btn"]:hover,
.error-panel + div .stButton > button[key="error_new_session_btn"]:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
}

/* ==========================================================================
   Configuration Modal (Story 6.1)
   ========================================================================== */

/* Streamlit dialog overrides for theme consistency */
[data-testid="stDialog"] > div,
[data-testid="stDialog"] > div > div,
[data-testid="stDialog"] [data-testid="stVerticalBlockBorderWrapper"],
[data-testid="stDialog"] [data-testid="stVerticalBlockBorderWrapper"] > div {
  background: var(--bg-primary) !important;
  background-color: var(--bg-primary) !important;
  border-color: var(--bg-secondary) !important;
}

[data-testid="stDialog"] > div {
  border: 1px solid var(--bg-secondary) !important;
  border-radius: 12px !important;
  max-width: 600px !important;
}

[data-testid="stDialog"] [data-testid="stVerticalBlock"] {
  background: transparent !important;
}

/* Force all dialog content to use dark theme colors */
[data-testid="stDialog"] * {
  color: var(--text-primary);
}

[data-testid="stDialog"] p,
[data-testid="stDialog"] span,
[data-testid="stDialog"] label {
  color: var(--text-secondary) !important;
}

[data-testid="stDialog"] h1,
[data-testid="stDialog"] h2,
[data-testid="stDialog"] h3,
[data-testid="stDialog"] h4 {
  color: var(--text-primary) !important;
}

/* Modal overlay - dark backdrop */
[data-testid="stModal"] > div:first-child {
  background: rgba(0, 0, 0, 0.6) !important;
}

/* Tab styling within config modal */
[data-testid="stDialog"] .stTabs [data-baseweb="tab-list"] {
  background: transparent;
  border-bottom: 1px solid var(--bg-secondary);
  gap: 0;
}

[data-testid="stDialog"] .stTabs [data-baseweb="tab"] {
  color: var(--text-secondary);
  font-family: var(--font-ui);
  font-size: 14px;
  font-weight: 500;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 2px solid transparent;
  background: transparent;
}

[data-testid="stDialog"] .stTabs [data-baseweb="tab"]:hover {
  color: var(--text-primary);
}

[data-testid="stDialog"] .stTabs [aria-selected="true"] {
  color: var(--accent-warm) !important;
  border-bottom: 2px solid var(--accent-warm) !important;
}

/* Config modal header styling */
.config-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: var(--space-md);
  border-bottom: 1px solid var(--bg-secondary);
  margin-bottom: var(--space-md);
}

.config-modal-title {
  font-family: var(--font-ui);
  font-size: 18px;
  font-weight: 600;
  color: var(--color-dm);
  margin: 0;
}

/* Close button styling */
.config-modal-close {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 20px;
  padding: var(--space-xs);
  border-radius: 4px;
  transition: all 0.15s ease;
}

.config-modal-close:hover {
  color: var(--text-primary);
  background: var(--bg-secondary);
}

/* Config modal footer */
.config-modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-md);
  padding-top: var(--space-lg);
  border-top: 1px solid var(--bg-secondary);
  margin-top: var(--space-lg);
}

/* Tab content placeholder styling */
.config-tab-placeholder {
  padding: var(--space-lg);
  text-align: center;
  color: var(--text-secondary);
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  font-style: italic;
}

/* Discard confirmation dialog */
.discard-confirmation {
  background: rgba(232, 168, 73, 0.1);
  border: 1px solid var(--accent-warm);
  border-radius: 8px;
  padding: var(--space-md);
  margin: var(--space-md) 0;
}

.discard-confirmation-text {
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  color: var(--accent-warm);
  margin-bottom: var(--space-sm);
}

/* Config modal buttons - Save (primary) */
[data-testid="stDialog"] .stButton > button[data-testid="config_save_btn"] {
  background: var(--accent-warm);
  border: none;
  color: var(--bg-primary);
  font-weight: 500;
}

[data-testid="stDialog"] .stButton > button[data-testid="config_save_btn"]:hover {
  background: #D49A3D;
}

/* Config modal buttons - Cancel (secondary) */
[data-testid="stDialog"] .stButton > button[data-testid="config_cancel_btn"] {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
}

[data-testid="stDialog"] .stButton > button[data-testid="config_cancel_btn"]:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
}

/* Configure button in sidebar - secondary outline style */
[data-testid="stSidebar"] .stButton > button[data-testid="configure_btn"] {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  width: 100%;
  font-family: var(--font-ui);
  font-size: var(--text-system);
  transition: all 0.15s ease;
}

[data-testid="stSidebar"] .stButton > button[data-testid="configure_btn"]:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
  color: var(--text-primary);
}

/* ==========================================================================
   API Key Management UI (Story 6.2)
   ========================================================================== */

/* API Keys section header */
.api-keys-section-header {
  font-family: var(--font-ui);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 var(--space-md) 0;
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--bg-secondary);
}

/* API key field container */
.api-key-field {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

/* API key field label */
.api-key-label {
  font-family: var(--font-ui);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-xs);
}

/* API key field help text */
.api-key-help {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
}

/* API key source badge (environment indicator) */
.api-key-source-badge {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 4px;
  margin-bottom: var(--space-sm);
}

.api-key-source-badge.environment {
  background: rgba(107, 142, 107, 0.2);
  color: var(--color-rogue);
  border: 1px solid rgba(107, 142, 107, 0.3);
}

.api-key-source-badge.empty {
  background: rgba(184, 168, 150, 0.2);
  color: var(--text-secondary);
  border: 1px solid rgba(184, 168, 150, 0.3);
}

/* API key validation status container */
.api-key-status {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-family: var(--font-ui);
  font-size: var(--text-system);
  padding: var(--space-xs) var(--space-sm);
  border-radius: 4px;
  margin-top: var(--space-sm);
}

/* Validation status - untested */
.api-key-status.untested {
  background: rgba(184, 168, 150, 0.1);
  color: var(--text-secondary);
}

/* Validation status - validating */
.api-key-status.validating {
  background: rgba(232, 168, 73, 0.1);
  color: var(--accent-warm);
}

/* Validation status - valid */
.api-key-status.valid {
  background: rgba(107, 142, 107, 0.15);
  color: var(--color-rogue);
}

/* Validation status - invalid */
.api-key-status.invalid {
  background: rgba(196, 92, 74, 0.15);
  color: var(--color-fighter);
}

/* Validation status icon */
.api-key-status-icon {
  font-size: 14px;
  font-weight: 600;
  width: 18px;
  text-align: center;
}

/* Validation status spinner (CSS animation) */
.api-key-status-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid var(--accent-warm);
  border-top-color: transparent;
  border-radius: 50%;
  animation: api-key-spin 1s linear infinite;
}

@keyframes api-key-spin {
  to { transform: rotate(360deg); }
}

/* Validation status text */
.api-key-status-text {
  font-size: var(--text-system);
}

/* Ollama models list */
.ollama-models {
  max-height: 150px;
  overflow-y: auto;
  padding: var(--space-sm);
}

.ollama-model-item {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-secondary);
  padding: var(--space-xs) 0;
  border-bottom: 1px solid var(--bg-secondary);
}

.ollama-model-item:last-child {
  border-bottom: none;
}

/* API key input field overrides within modal */
[data-testid="stDialog"] .api-key-field .stTextInput > div > div > input {
  background: var(--bg-message);
  border: 1px solid var(--bg-message);
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 13px;
}

[data-testid="stDialog"] .api-key-field .stTextInput > div > div > input:focus {
  border-color: var(--accent-warm);
  box-shadow: 0 0 0 1px var(--accent-warm);
}

[data-testid="stDialog"] .api-key-field .stTextInput > div > div > input::placeholder {
  color: var(--text-secondary);
  font-family: var(--font-ui);
  font-style: italic;
}

/* Show/Hide toggle button in API key field */
[data-testid="stDialog"] .api-key-field .stButton > button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-secondary);
  padding: var(--space-xs) var(--space-sm);
  font-size: 12px;
  height: auto;
  min-height: 38px;
}

[data-testid="stDialog"] .api-key-field .stButton > button:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
  color: var(--text-primary);
}

/* Validate button styling */
[data-testid="stDialog"] .api-key-field .stButton > button[data-testid*="validate_"] {
  background: transparent;
  border: 1px solid var(--accent-warm);
  color: var(--accent-warm);
  width: auto;
  margin-top: var(--space-sm);
}

[data-testid="stDialog"] .api-key-field .stButton > button[data-testid*="validate_"]:hover {
  background: var(--accent-warm);
  color: var(--bg-primary);
}

/* ==========================================================================
   Agent Model Selection UI (Story 6.3)
   ========================================================================== */

/* Agent model grid container */
.agent-model-grid {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

/* Individual agent model row */
.agent-model-row {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  border-left: 3px solid var(--text-secondary);
}

/* DM row styling */
.agent-model-row.dm {
  border-left-color: var(--color-dm);
}

/* PC rows by class */
.agent-model-row.fighter {
  border-left-color: var(--color-fighter);
}

.agent-model-row.rogue {
  border-left-color: var(--color-rogue);
}

.agent-model-row.wizard {
  border-left-color: var(--color-wizard);
}

.agent-model-row.cleric {
  border-left-color: var(--color-cleric);
}

/* Summarizer row styling */
.agent-model-row.summarizer {
  border-left-color: var(--text-secondary);
  opacity: 0.9;
}

/* Agent name styling within row */
.agent-model-name {
  font-family: var(--font-ui);
  font-size: var(--text-name);
  font-weight: 600;
  margin-bottom: var(--space-xs);
}

.agent-model-name.dm {
  color: var(--color-dm);
}

.agent-model-name.fighter {
  color: var(--color-fighter);
}

.agent-model-name.rogue {
  color: var(--color-rogue);
}

.agent-model-name.wizard {
  color: var(--color-wizard);
}

.agent-model-name.cleric {
  color: var(--color-cleric);
}

.agent-model-name.summarizer {
  color: var(--text-secondary);
}

/* Status badge styling */
.agent-status-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-family: var(--font-ui);
  font-size: 11px;
  font-weight: 500;
  text-align: center;
  margin-left: var(--space-sm);
}

.agent-status-badge.active {
  background: rgba(232, 168, 73, 0.2);
  color: var(--accent-warm);
}

.agent-status-badge.ai {
  background: rgba(107, 142, 107, 0.2);
  color: var(--color-rogue);
}

.agent-status-badge.you {
  background: rgba(123, 104, 184, 0.2);
  color: var(--color-wizard);
}

/* Quick actions container */
.model-quick-actions {
  display: flex;
  gap: var(--space-md);
  margin-top: var(--space-lg);
  padding-top: var(--space-md);
  border-top: 1px solid var(--bg-secondary);
}

/* Separator line between PCs and Summarizer */
.model-separator {
  height: 1px;
  background: var(--bg-secondary);
  margin: var(--space-md) 0;
}

/* Models tab section header */
.models-section-header {
  font-family: var(--font-ui);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 var(--space-md) 0;
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--bg-secondary);
}

/* Model help text */
.model-help-text {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: var(--space-xs);
  font-style: italic;
}

/* Quick action buttons - secondary style */
[data-testid="stDialog"] .model-quick-actions .stButton > button {
  background: transparent;
  border: 1px solid var(--text-secondary);
  color: var(--text-primary);
  font-size: 13px;
}

[data-testid="stDialog"] .model-quick-actions .stButton > button:hover {
  background: var(--bg-message);
  border-color: var(--text-primary);
}

/* Selectbox styling within agent model rows */
[data-testid="stDialog"] .agent-model-row .stSelectbox label {
  color: var(--text-secondary);
  font-size: 12px;
}

[data-testid="stDialog"] .agent-model-row [data-baseweb="select"] {
  background-color: var(--bg-message);
}

/* ==========================================================================
   Token Limit Configuration (Story 6.4)
   ========================================================================== */

/* Settings tab section header */
.settings-section-header {
  font-family: var(--font-ui);
  font-size: 16px;
  font-weight: 600;
  color: var(--accent-warm);
  margin: 0 0 var(--space-lg) 0;
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--bg-secondary);
}

/* Token limit row container */
.token-limit-row {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  margin-bottom: var(--space-md);
  border-left: 3px solid var(--text-secondary);
}

/* Character-specific row colors */
.token-limit-row.dm { border-left-color: var(--color-dm); }
.token-limit-row.fighter { border-left-color: var(--color-fighter); }
.token-limit-row.rogue { border-left-color: var(--color-rogue); }
.token-limit-row.wizard { border-left-color: var(--color-wizard); }
.token-limit-row.cleric { border-left-color: var(--color-cleric); }
.token-limit-row.summarizer { border-left-color: var(--text-secondary); opacity: 0.9; }

/* Token limit hint text (model max) */
.token-limit-hint {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--text-secondary);
  display: block;
  margin-top: var(--space-sm);
}

/* Token limit warning (low limit) */
.token-limit-warning {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--accent-warm);
  display: block;
  margin-top: var(--space-xs);
}

/* Token limit info message (clamping) */
.token-limit-info {
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--color-cleric);  /* Blue for info */
  display: block;
  margin-top: var(--space-xs);
}

/* Token limit separator between PCs and Summarizer */
.token-limit-separator {
  height: 1px;
  background: var(--bg-secondary);
  margin: var(--space-lg) 0;
}

/* Number input styling within token limit rows */
[data-testid="stDialog"] .token-limit-row .stNumberInput > div > div > input {
  background: var(--bg-message);
  border: 1px solid var(--bg-message);
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 14px;
}

[data-testid="stDialog"] .token-limit-row .stNumberInput > div > div > input:focus {
  border-color: var(--accent-warm);
  box-shadow: 0 0 0 1px var(--accent-warm);
}

/* Number input buttons styling */
[data-testid="stDialog"] .token-limit-row .stNumberInput button {
  background: var(--bg-message);
  border: 1px solid var(--bg-secondary);
  color: var(--text-secondary);
}

[data-testid="stDialog"] .token-limit-row .stNumberInput button:hover {
  background: var(--bg-secondary);
  color: var(--text-primary);
}

/* ==========================================================================
   Mid-Campaign Provider Switching (Story 6.5)
   ========================================================================== */

/* Pending change badge - shows when agent has uncommitted override */
.pending-change-badge {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--accent-warm);
  background: rgba(232, 168, 73, 0.15);
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: var(--space-sm);
}

/* ==========================================================================
   Module Discovery Loading State (Story 7.1)
   ========================================================================== */

.module-discovery-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-xl);
  text-align: center;
  min-height: 300px;
}

.module-discovery-loading .loading-icon {
  font-size: 48px;
  margin-bottom: var(--space-lg);
  animation: book-pulse 2s ease-in-out infinite;
}

.module-discovery-loading .loading-text {
  font-family: var(--font-narrative);
  font-size: 20px;
  font-style: italic;
  color: var(--text-primary);
  margin-bottom: var(--space-sm);
}

.module-discovery-loading .loading-subtext {
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--text-secondary);
}

@keyframes book-pulse {
  0%, 100% { opacity: 0.7; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.1); }
}

/* Module discovery error state */
.module-discovery-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-lg);
  text-align: center;
  background: var(--bg-secondary);
  border-radius: 8px;
  border-left: 4px solid var(--color-fighter);
  margin: var(--space-lg) 0;
}

.module-discovery-error .error-title {
  font-family: var(--font-narrative);
  font-size: 18px;
  color: var(--accent-warm);
  margin-bottom: var(--space-sm);
}

.module-discovery-error .error-message {
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--text-primary);
  margin-bottom: var(--space-md);
}

.module-discovery-error .error-action {
  font-family: var(--font-ui);
  font-size: 13px;
  color: var(--text-secondary);
  font-style: italic;
}

/* Provider unavailable warning - shows when current provider is down */
.provider-unavailable-warning {
  display: block;
  font-family: var(--font-ui);
  font-size: 12px;
  color: var(--color-fighter);
  background: rgba(196, 92, 74, 0.15);
  padding: var(--space-xs) var(--space-sm);
  border-radius: 4px;
  margin-top: var(--space-xs);
  border-left: 2px solid var(--color-fighter);
}

/* Provider status indicator - available (green checkmark) */
.provider-status-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-family: var(--font-ui);
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: var(--space-sm);
}

.provider-status-indicator.available {
  color: var(--color-rogue);
  background: rgba(107, 142, 107, 0.15);
}

.provider-status-indicator.unavailable {
  color: var(--color-fighter);
  background: rgba(196, 92, 74, 0.15);
}

/* ==========================================================================
   LLM Status Expander (High Contrast)
   ========================================================================== */

/* LLM Status content - ensure high contrast text */
[data-testid="stSidebar"] [data-testid="stExpander"] p,
[data-testid="stSidebar"] [data-testid="stExpander"] li {
  color: var(--text-primary) !important;
  font-size: 13px;
}

/* Warning messages in LLM Status */
[data-testid="stSidebar"] [data-testid="stAlert"] {
  background: rgba(232, 168, 73, 0.15) !important;
  border-color: var(--accent-warm) !important;
  color: var(--text-primary) !important;
}

[data-testid="stSidebar"] [data-testid="stAlert"] p {
  color: var(--accent-warm) !important;
}

/* ==========================================================================
   Module Selection UI (Story 7.2)
   ========================================================================== */

/* Module selection container */
.module-selection-container {
  padding: var(--space-lg);
}

/* Search bar styling */
.module-search {
  margin-bottom: var(--space-lg);
}

.module-search input {
  background: var(--bg-secondary);
  border: 1px solid var(--text-secondary);
  border-radius: 6px;
  color: var(--text-primary);
  padding: var(--space-sm) var(--space-md);
  font-family: var(--font-ui);
}

.module-search input:focus {
  border-color: var(--accent-warm);
  outline: none;
  box-shadow: 0 0 0 2px rgba(232, 168, 73, 0.2);
}

/* Module grid container */
.module-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-md);
}

/* Module card styling - follows character-card pattern */
.module-card {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  border: 1px solid var(--text-secondary);
  transition: all 0.2s ease-in-out;
  /* Note: Selection is handled by the Select button, not card click */
}

.module-card:hover {
  border-color: var(--accent-warm);
  box-shadow: 0 4px 12px rgba(232, 168, 73, 0.15);
  transform: translateY(-2px);
}

.module-card.selected {
  border-color: var(--accent-warm);
  background: var(--bg-message);
  box-shadow: 0 0 12px rgba(232, 168, 73, 0.25);
}

.module-name {
  font-family: var(--font-narrative);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-sm);
}

.module-description {
  font-family: var(--font-ui);
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
  margin-bottom: var(--space-sm);
}

/* Module confirmation view */
.module-confirmation {
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: var(--space-xl);
  margin-bottom: var(--space-lg);
  border-left: 4px solid var(--accent-warm);
}

.module-title {
  font-family: var(--font-narrative);
  font-size: 28px;
  color: var(--accent-warm);
  margin-bottom: var(--space-md);
}

.module-full-description {
  font-family: var(--font-narrative);
  font-size: 16px;
  color: var(--text-primary);
  line-height: 1.7;
  font-style: italic;
}

/* Random module button */
.random-module-btn {
  background: transparent;
  border: 2px dashed var(--accent-warm);
  color: var(--accent-warm);
  padding: var(--space-sm) var(--space-md);
  border-radius: 6px;
  font-family: var(--font-ui);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.random-module-btn:hover {
  background: rgba(232, 168, 73, 0.1);
  border-style: solid;
}

/* Results count */
.module-results-count {
  font-family: var(--font-ui);
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: var(--space-md);
}

/* ==========================================================================
   New Adventure Flow (Story 7.4)
   ========================================================================== */

/* Step header for multi-step flow */
.step-header {
  font-family: var(--font-narrative);
  font-size: 28px;
  color: var(--accent-warm);
  margin-bottom: var(--space-sm);
}

/* Module selection view container */
.module-selection-view {
  padding: var(--space-lg);
  max-width: 1200px;
  margin: 0 auto;
}

/* Module banner in game view */
.module-banner {
  background: var(--bg-secondary);
  border-left: 3px solid var(--accent-warm);
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-md);
  border-radius: 0 6px 6px 0;
}

.module-banner-title {
  font-family: var(--font-narrative);
  font-size: 16px;
  color: var(--accent-warm);
  font-weight: 600;
}

.module-banner-description {
  font-family: var(--font-narrative);
  font-size: 14px;
  color: var(--text-secondary);
  font-style: italic;
  line-height: 1.5;
  margin-top: var(--space-sm);
}

/* Module banner collapsed state (expander header styling) */
.module-banner-collapsed {
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.module-banner-collapsed:hover {
  background: var(--bg-message);
}

/* Module banner expanded state */
.module-banner-expanded {
  padding: var(--space-md);
}

/* Responsive behavior for module banner */
@media (max-width: 768px) {
  .module-banner {
    padding: var(--space-xs) var(--space-sm);
  }

  .module-banner-title {
    font-size: 14px;
  }

  .module-banner-description {
    font-size: 12px;
  }
}

/* ==========================================================================
   Character Sheet Modal (Story 8.2)
   ========================================================================== */

.character-sheet-header {
    text-align: center;
    padding: 16px;
    border-bottom: 2px solid var(--accent-warm, #E8A849);
    margin-bottom: 16px;
}

.character-sheet-name {
    font-family: Lora, Georgia, serif;
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary, #F5E6D3);
    margin: 0;
}

.character-sheet-subtitle {
    font-family: Inter, system-ui, sans-serif;
    font-size: 14px;
    color: var(--text-secondary, #B8A896);
    margin: 4px 0 0 0;
}

.proficiency-badge {
    display: inline-block;
    font-family: var(--font-mono, monospace);
    font-size: 12px;
    color: var(--accent-warm, #E8A849);
    background: rgba(232, 168, 73, 0.15);
    padding: 4px 8px;
    border-radius: 4px;
    margin-top: 8px;
}

/* Ability Score Cards */
.ability-scores-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 16px;
}

.ability-score-card {
    background: var(--bg-message, #3D3530);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
    border: 1px solid var(--bg-secondary, #2D2520);
}

.ability-name {
    display: block;
    font-family: Inter, system-ui, sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary, #B8A896);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ability-modifier {
    display: block;
    font-family: JetBrains Mono, monospace;
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary, #F5E6D3);
}

.ability-score {
    display: block;
    font-family: JetBrains Mono, monospace;
    font-size: 14px;
    color: var(--text-secondary, #B8A896);
}

/* Combat Stats */
.combat-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
}

.combat-stat {
    background: var(--bg-message, #3D3530);
    border-radius: 6px;
    padding: 8px 12px;
    text-align: center;
    min-width: 60px;
}

.stat-label {
    display: block;
    font-family: Inter, system-ui, sans-serif;
    font-size: 11px;
    color: var(--text-secondary, #B8A896);
    text-transform: uppercase;
}

.stat-value {
    display: block;
    font-family: JetBrains Mono, monospace;
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary, #F5E6D3);
}

/* HP Bar */
.hp-container {
    width: 100%;
    margin: 8px 0;
}

.hp-bar-bg {
    background: var(--bg-secondary, #2D2520);
    border-radius: 4px;
    height: 20px;
    overflow: hidden;
}

.hp-bar-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.hp-text {
    font-family: JetBrains Mono, monospace;
    font-size: 14px;
    color: var(--text-primary, #F5E6D3);
    display: block;
    text-align: center;
    margin-top: 4px;
}

.hit-dice-info {
    background: var(--bg-message, #3D3530);
    border-radius: 6px;
    padding: 8px 12px;
    text-align: center;
}

/* Spell Slots */
.spell-slots-container {
    margin: 8px 0;
}

.spell-slot-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 4px 0;
}

.spell-level {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-secondary, #B8A896);
    min-width: 60px;
}

.spell-dots {
    font-family: JetBrains Mono, monospace;
    font-size: 14px;
    color: var(--accent-warm, #E8A849);
    letter-spacing: 2px;
}

/* Spellcasting Section */
.spellcasting-section {
    margin-bottom: 16px;
}

.spell-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-bottom: 12px;
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-secondary, #B8A896);
}

.spell-list {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-primary, #F5E6D3);
    margin-bottom: 8px;
}

.spell-entry {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid var(--bg-secondary, #2D2520);
}

.spell-name {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-primary, #F5E6D3);
}

.spell-level-label {
    font-family: Inter, system-ui, sans-serif;
    font-size: 12px;
    color: var(--text-secondary, #B8A896);
}

/* Skill Section */
.skills-section {
    margin-bottom: 16px;
}

.skill-row {
    display: flex;
    align-items: center;
    padding: 4px 0;
    border-bottom: 1px solid var(--bg-secondary, #2D2520);
}

.skill-proficiency {
    width: 24px;
    font-size: 12px;
    color: var(--accent-warm, #E8A849);
}

.skill-name {
    flex: 1;
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-primary, #F5E6D3);
}

.skill-modifier {
    font-family: JetBrains Mono, monospace;
    font-size: 13px;
    color: var(--text-secondary, #B8A896);
}

/* Section Headers */
.sheet-section-header {
    font-family: Inter, system-ui, sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent-warm, #E8A849);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 16px 0 8px 0;
    padding-bottom: 4px;
    border-bottom: 1px solid var(--bg-secondary, #2D2520);
}

/* Equipment Section */
.equipment-section {
    margin-bottom: 16px;
}

.equipment-item {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-primary, #F5E6D3);
    padding: 4px 0;
    border-bottom: 1px solid var(--bg-secondary, #2D2520);
}

.equipment-detail {
    font-size: 12px;
    color: var(--text-secondary, #B8A896);
    margin-left: 8px;
}

/* Features Section */
.features-section {
    margin-bottom: 16px;
}

.feature-item {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-primary, #F5E6D3);
    padding: 4px 0;
    padding-left: 8px;
    border-left: 2px solid var(--bg-secondary, #2D2520);
    margin-bottom: 4px;
}

/* Personality Section */
.personality-section {
    margin-bottom: 16px;
}

.personality-item {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--text-secondary, #B8A896);
    font-style: italic;
    padding: 4px 0;
    line-height: 1.5;
}

.conditions-list {
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
    color: var(--color-fighter, #C45C4A);
    font-weight: 500;
}

/* Clickable Character Name in Party Panel */
.character-card-wrapper .stButton > button[data-testid*="view_sheet_"] {
    background: transparent !important;
    border: none !important;
    color: inherit;
    font-family: var(--font-ui);
    font-size: var(--text-name);
    font-weight: 600;
    padding: 0;
    margin: 0;
    text-align: left;
    cursor: pointer;
    transition: color 0.2s ease;
    width: auto !important;
    height: auto !important;
    min-height: 0 !important;
}

.character-card-wrapper .stButton > button[data-testid*="view_sheet_"]:hover {
    color: var(--accent-warm, #E8A849) !important;
    text-decoration: underline;
    background: transparent !important;
}

/* Character-specific name colors in character card buttons */
.character-card-wrapper.fighter .stButton > button[data-testid*="view_sheet_"] {
    color: var(--color-fighter, #C45C4A);
}

.character-card-wrapper.rogue .stButton > button[data-testid*="view_sheet_"] {
    color: var(--color-rogue, #6B8E6B);
}

.character-card-wrapper.wizard .stButton > button[data-testid*="view_sheet_"] {
    color: var(--color-wizard, #7B68B8);
}

.character-card-wrapper.cleric .stButton > button[data-testid*="view_sheet_"] {
    color: var(--color-cleric, #4A90A4);
}

/* Focus-visible styles for keyboard navigation (Story 8.2 accessibility) */
.character-card-wrapper .stButton > button[data-testid*="view_sheet_"]:focus-visible {
    outline: 2px solid var(--accent-warm, #E8A849);
    outline-offset: 2px;
    border-radius: 2px;
}

/* Screen reader only utility class */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Death Saves (Story 8.2 Task 4.7) */
.death-saves {
    background: rgba(196, 92, 74, 0.15);
    border: 1px solid var(--color-fighter, #C45C4A);
    border-radius: 6px;
    padding: 12px;
    margin: 8px 0;
}

.death-save-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 4px 0;
}

.death-save-label {
    font-family: Inter, system-ui, sans-serif;
    font-size: 12px;
    color: var(--text-secondary, #B8A896);
    min-width: 70px;
}

.death-save-dots {
    font-family: JetBrains Mono, monospace;
    font-size: 14px;
    letter-spacing: 4px;
}

.death-save-dots.success {
    color: var(--color-rogue, #6B8E6B);
}

.death-save-dots.failure {
    color: var(--color-fighter, #C45C4A);
}

.death-save-stable {
    display: block;
    font-family: Inter, system-ui, sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: var(--color-rogue, #6B8E6B);
    text-transform: uppercase;
    margin-top: 8px;
}

.death-save-dead {
    display: block;
    font-family: Inter, system-ui, sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: var(--color-fighter, #C45C4A);
    text-transform: uppercase;
    margin-top: 8px;
}

/* Responsive Character Sheet (Story 8.2) */
@media (max-width: 768px) {
    .ability-scores-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .combat-stats {
        flex-direction: column;
    }

    .spell-stats {
        flex-direction: column;
        gap: 8px;
    }
}

/* ==========================================================================
   Secret Revelation System (Story 10.5)
   ========================================================================== */

/* Secret revealed notification - dramatic gold/amber styling */
.secret-revealed-notification {
  background: rgba(232, 168, 73, 0.12);
  border-left: 4px solid var(--accent-warm);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
  border-radius: 0 8px 8px 0;
  animation: secret-reveal-glow 2s ease-out;
}

.secret-revealed-notification p {
  font-family: var(--font-ui);
  font-size: 14px;
  line-height: 1.5;
  color: var(--accent-warm);
  margin: 0;
}

.secret-revealed-notification strong {
  font-weight: 600;
  letter-spacing: 0.05em;
}

@keyframes secret-reveal-glow {
  0% {
    background: rgba(232, 168, 73, 0.25);
    box-shadow: 0 0 12px rgba(232, 168, 73, 0.4);
  }
  100% {
    background: rgba(232, 168, 73, 0.12);
    box-shadow: none;
  }
}

/* Respect reduced motion preference (accessibility) */
@media (prefers-reduced-motion: reduce) {
  .secret-revealed-notification {
    animation: none;
  }
}

/* Whisper History Container (Debug/Review mode) */
.whisper-history-container {
  background: var(--bg-secondary);
  border-radius: 8px;
  padding: var(--space-md);
  margin-top: var(--space-md);
}

.whisper-history-container > p {
  font-family: var(--font-ui);
  font-size: var(--text-ui);
  color: var(--text-secondary);
  font-style: italic;
}

/* Agent group within whisper history */
.whisper-agent-group {
  margin-bottom: var(--space-md);
}

.whisper-agent-name {
  font-family: var(--font-ui);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 var(--space-sm) 0;
  padding-bottom: var(--space-xs);
  border-bottom: 1px solid var(--bg-message);
}

/* Individual whisper item */
.whisper-item {
  background: var(--bg-message);
  border-radius: 6px;
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-sm);
  border-left: 3px solid var(--color-wizard);
}

.whisper-item.whisper-revealed {
  border-left-color: var(--accent-warm);
  opacity: 0.8;
}

.whisper-item.whisper-active {
  border-left-color: var(--color-wizard);
}

.whisper-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-xs);
}

.whisper-status {
  font-family: var(--font-ui);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 2px 6px;
  border-radius: 3px;
}

.whisper-status.active {
  background: rgba(123, 104, 184, 0.2);
  color: var(--color-wizard);
}

.whisper-status.revealed {
  background: rgba(232, 168, 73, 0.2);
  color: var(--accent-warm);
}

.whisper-turn {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--text-secondary);
}

.whisper-content {
  font-family: var(--font-narrative);
  font-size: var(--text-system);
  color: var(--text-primary);
  margin: 0;
  line-height: 1.4;
}

.whisper-item.whisper-revealed .whisper-content {
  color: var(--text-secondary);
}

/* ==========================================================================
   Story Threads Panel (Story 11.5 - FR80)
   ========================================================================== */

/* Summary statistics line */
.story-threads-summary {
  font-family: var(--font-ui);
  font-size: var(--text-system);
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
}

/* Narrative element card (follows character-card pattern) */
.story-element-card {
  background: var(--bg-secondary);
  border-radius: 6px;
  padding: var(--space-sm);
  margin-bottom: var(--space-xs);
  border-left: 3px solid var(--text-secondary);
}

/* Element type color classes */
.story-element-card.type-character { border-left-color: var(--color-fighter); }
.story-element-card.type-item { border-left-color: var(--accent-warm); }
.story-element-card.type-location { border-left-color: var(--color-rogue); }
.story-element-card.type-event { border-left-color: var(--color-wizard); }
.story-element-card.type-promise { border-left-color: var(--color-cleric); }
.story-element-card.type-threat { border-left-color: var(--color-fighter); }

/* Dormant elements - grayed out per AC */
.story-element-card.dormant {
  opacity: 0.55;
  border-left-color: var(--bg-message);
}

/* Resolved elements */
.story-element-card.resolved {
  opacity: 0.4;
}

.story-element-card.resolved .story-element-name {
  text-decoration: line-through;
}

/* Element name */
.story-element-name {
  font-family: var(--font-ui);
  font-size: var(--text-name);
  font-weight: 600;
  color: var(--text-primary);
  display: inline;
}

/* Element metadata line (type, turn, session) */
.story-element-meta {
  font-size: var(--text-system);
  color: var(--text-secondary);
  margin-top: 2px;
}

/* Reference count and status badges */
.story-element-badge {
  display: inline-block;
  font-family: var(--font-ui);
  font-size: 11px;
  padding: 1px 6px;
  border-radius: 8px;
  background: var(--bg-message);
  color: var(--text-secondary);
  margin-left: var(--space-xs);
  vertical-align: middle;
}

/* Story moment badge - amber accent */
.story-element-badge.story-moment {
  background: rgba(232, 168, 73, 0.2);
  color: var(--accent-warm);
}

/* Dormant badge */
.story-element-badge.dormant-badge {
  background: rgba(61, 53, 48, 0.5);
  color: var(--text-secondary);
}

/* Element description (italic narrative font) */
.story-element-description {
  font-family: var(--font-narrative);
  font-size: var(--text-system);
  font-style: italic;
  color: var(--text-secondary);
  margin: var(--space-xs) 0;
}

/* Detail section within expanded element */
.story-element-detail {
  font-size: var(--text-system);
  color: var(--text-secondary);
  margin-top: var(--space-xs);
}

.story-element-detail strong {
  color: var(--text-primary);
}

/* Callback timeline (vertical line with dots) */
.callback-timeline {
  margin-top: var(--space-xs);
  padding-left: var(--space-sm);
  border-left: 2px solid var(--bg-message);
}

/* Individual timeline entry */
.callback-timeline-entry {
  font-size: var(--text-system);
  color: var(--text-secondary);
  padding: 2px 0 2px var(--space-sm);
  position: relative;
}

/* Timeline dot marker */
.callback-timeline-entry::before {
  content: "";
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--text-secondary);
  position: absolute;
  left: calc(var(--space-sm) * -1 - 4px);
  top: 8px;
}

/* Story moment timeline entry - amber dot */
.callback-timeline-entry.story-moment::before {
  background: var(--accent-warm);
}

/* Context snippet within timeline entry (dimmed excerpt) */
.callback-context-snippet {
  opacity: 0.7;
}

/* Introduction entry (brighter than regular callbacks) */
.callback-timeline-entry.introduced {
  color: var(--text-primary);
  font-weight: 500;
}

/* ==========================================================================
   Fork Comparison View (Story 12.3)
   ========================================================================== */

/* Comparison container: two-column grid layout */
.comparison-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-md);
}

/* Column header styling */
.comparison-header {
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--bg-secondary);
}

/* Turn number label (monospace) */
.comparison-turn-number {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-secondary);
  margin-bottom: var(--space-xs);
}

/* Turn content text */
.comparison-turn-content {
  font-family: 'Lora', Georgia, serif;
  font-size: 14px;
  line-height: 1.5;
  color: var(--text-primary);
}

/* Branch point / divergence highlight (amber tint) */
.comparison-divergence {
  background: rgba(232, 168, 73, 0.1);
  border-left: 2px solid var(--accent-warm);
  padding: var(--space-sm);
  padding-left: var(--space-sm);
  margin-bottom: var(--space-md);
  border-radius: 4px;
}

/* Timeline ended indicator */
.comparison-ended {
  text-align: center;
  padding: var(--space-lg);
  color: var(--color-fighter);
  font-family: Inter, sans-serif;
  font-style: italic;
}

/* Current turn indicator (green tint) */
.comparison-current {
  text-align: center;
  padding: var(--space-sm);
  background: rgba(107, 142, 107, 0.15);
  border-radius: 4px;
  color: var(--color-rogue);
  font-family: Inter, sans-serif;
  font-size: 12px;
}
